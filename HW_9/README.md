# Домашнее задание 9. Хранимые процедуры

## [Содержание](./../README.md)

* [**ДЗ-1. Установка и использование СУБД**](./../HW_1)
* [**ДЗ-2. Моделирование БД «Университет»**](./../HW_2)
* [**ДЗ-3. Функциональные зависимости в БД «Университет»**](./../HW_3)
* [**ДЗ-4. Нормализация БД «Университет»**](./../HW_4)
* [**ДЗ-5. Реляционная алгебра**](./../HW_5)
* [**ДЗ-6. Реляционное исчисление**](./../HW_6)
* [**ДЗ-7. Изменение данных**](./../HW_7)
* [**ДЗ-8. Индексирование**](./../HW_8)
* **ДЗ-9. Хранимые процедуры**
* [**ДЗ-10. Транзакции**](./../HW_10)
* [**КР-1. Контрольная по запросам**](./../CW_1)
* [**Технические особенности проверки**](./../Technical_specifics.md)

---

## Задание

#### В базе данных `Airline` информация о рейсах самолётов задана в виде таблиц

```sql
create table Flights
(
    FlightId   integer,
    FlightTime timestamp,
    PlaneId    integer,
    -- Дополнительные столбцы, при необходимости
);

create table Seats
(
    PlaneId integer,
    SeatNo  varchar(4), -- 123A
    -- Дополнительные столбцы, при необходимости
)
```

#### Реализуйте запросы к базе данных `Airline` с применением представлений, хранимых процедур и функций. При необходимости, вы можете создать дополнительные таблицы, представления и хранимые процедуры.

1. `FreeSeats(FlightId)` — список мест, доступных для продажи и для бронирования.
2. `Reserve(UserId, Pass, FlightId, SeatNo)` — пытается забронировать место на трое суток начиная с момента
   бронирования. Возвращает _истину_, если удалось и _ложь_ — в противном случае.
3. `ExtendReservation(UserId, Pass, FlightId, SeatNo)` — пытается продлить бронь места на трое суток начиная с момента
   продления. Возвращает _истину_, если удалось и _ложь_ — в противном случае.
4. `BuyFree(FlightId, SeatNo)` — пытается купить свободное место. Возвращает _истину_, если удалось и _ложь_ — в
   противном случае.
5. `BuyReserved(UserId, Pass, FlightId, SeatNo)` — пытается выкупить забронированное место (пользователи должны
   совпадать). Возвращает _истину_, если удалось и _ложь_ — в противном случае.
6. `FlightsStatistics(UserId, Pass)` — статистика по рейсам: возможность бронирования и покупки, число свободных,
   забронированных и проданных мест.
7. `FlightStat(UserId, Pass, FlightId)` — статистика по рейсу: возможность бронирования и покупки, число свободных,
   забронированных и проданных мест.
8. `CompressSeats(FlightId)` — оптимизирует занятость мест в самолете. В результате оптимизации, в начале самолета
   должны быть купленные места, затем — забронированные, а в конце — свободные. (_Примечание_: клиенты, которые уже
   выкупили билеты также должны быть пересажены)
